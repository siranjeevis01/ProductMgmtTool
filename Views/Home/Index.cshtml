@model ProductMgmt.Controllers.DashboardViewModel
@{
    ViewData["Title"] = "Dashboard";
}

@using System.Globalization

<h2 class="mb-4 text-dark fw-bold animate__animated animate__fadeInDown">Dashboard</h2>

<div class="row g-4">
    <!-- Total Categories Card -->
    <div class="col-md-4">
        <div class="card shadow-sm border-0 h-100 text-center dashboard-card gradient-blue">
            <div class="card-body d-flex flex-column justify-content-center">
                <i class="bi bi-tags display-4 mb-2"></i>
                <h6 class="text-muted mb-2">Total Categories</h6>
                <p class="display-5 fw-bold mb-3">@Model.TotalCategories</p>
                <a href="/Category" class="btn btn-outline-light btn-sm w-75 mx-auto">View Categories</a>
            </div>
        </div>
    </div>

    <!-- Total Products Card -->
    <div class="col-md-4">
        <div class="card shadow-sm border-0 h-100 text-center dashboard-card gradient-purple">
            <div class="card-body d-flex flex-column justify-content-center">
                <i class="bi bi-box-seam display-4 mb-2"></i>
                <h6 class="text-muted mb-2">Total Products</h6>
                <p class="display-5 fw-bold mb-3">@Model.TotalProducts</p>
                <a href="/Product" class="btn btn-outline-light btn-sm w-75 mx-auto">View Products</a>
            </div>
        </div>
    </div>

    <!-- Placeholder Card -->
    <div class="col-md-4">
        <div class="card shadow-sm border-0 h-100 text-center dashboard-card gradient-orange">
            <div class="card-body d-flex flex-column justify-content-center">
                <i class="bi bi-graph-up display-4 mb-2"></i>
                <h6 class="text-muted mb-2">Coming Soon</h6>
                <p class="display-5 fw-bold mb-3">--</p>
                <a href="#" class="btn btn-outline-secondary btn-sm w-75 mx-auto disabled">More Info</a>
            </div>
        </div>
    </div>
</div>

<!-- Filters -->
<div class="row mt-4 mb-3">
    <div class="col-md-6 mb-2">
        <input type="text" id="searchInput" class="form-control" placeholder="🔍 Search categories or products..." />
    </div>
    <div class="col-md-3 mb-2">
        <select id="filterSelect" class="form-select">
            <option value="">Filter by Type</option>
            <option value="category">Categories</option>
            <option value="product">Products</option>
        </select>
    </div>
    <div class="col-md-3 mb-2">
        <select id="sortSelect" class="form-select">
            <option value="name">Sort by Name</option>
            <option value="date">Sort by Recent</option>
        </select>
    </div>
</div>

<!-- Recent Categories -->
@if (Model.RecentCategories.Any())
{
    <h4 class="mt-3 mb-3 text-dark fw-bold">Recent Categories</h4>
    <div class="row g-4" id="categoriesContainer">
        @foreach (var cat in Model.RecentCategories)
        {
            <div class="col-md-3 col-sm-6 dashboard-item" data-type="category" data-name="@cat.Name.ToLower()" data-date="@cat.CreatedAt.ToString("yyyyMMdd")">
                <div class="card recent-card shadow-sm hover-card rounded-4 overflow-hidden">
                    <div class="card-img-container position-relative">
                        <img src="@(!string.IsNullOrEmpty(cat.ImageUrl) ? cat.ImageUrl : "/images/category-placeholder.png")"
                             class="card-img-top" alt="@cat.Name" />
                        <span class="badge position-absolute top-0 end-0 m-2 bg-warning text-dark">New</span>
                    </div>
                    <div class="card-body">
                        <h6 class="fw-bold">@cat.Name</h6>
                        <p class="text-muted mb-2" style="font-size:.85rem;">Created: @cat.CreatedAt.ToString("yyyy-MM-dd")</p>
                        <a href="/Category/Details/@cat.Id" class="btn btn-primary btn-sm w-100">View</a>
                    </div>
                </div>
            </div>
        }
    </div>
}

<!-- Recent Products -->
@if (Model.RecentProducts.Any())
{
    <h4 class="mt-5 mb-3 text-dark fw-bold">Recent Products</h4>
    <div class="row g-4" id="productsContainer">
        @foreach (var prod in Model.RecentProducts)
        {
            <div class="col-md-3 col-sm-6 dashboard-item" data-type="product" data-name="@prod.Name.ToLower()" data-date="@prod.CreatedAt.ToString("yyyyMMdd")">
                <div class="card recent-card shadow-sm hover-card rounded-4 overflow-hidden">
                    <div class="card-img-container position-relative">
                        <img src="@(!string.IsNullOrEmpty(prod.ImageUrl) ? prod.ImageUrl : "/images/product-placeholder.png")"
                             class="card-img-top" alt="@prod.Name" />
                        @if (prod.Category != null)
                        {
                            <span class="badge position-absolute top-0 start-0 m-2 bg-info text-dark">@prod.Category.Name</span>
                        }
                    </div>
                    <div class="card-body d-flex flex-column">
                        <h6 class="fw-bold">@prod.Name</h6>
                        <p class="text-muted mb-1" style="font-size:.85rem;">SKU: @prod.SKU</p>
                        <p class="text-success fw-semibold mb-2">@prod.Price.ToString("C", new CultureInfo("en-IN"))</p>
                        <a href="/Product/Details/@prod.Id" class="btn btn-primary btn-sm mt-auto w-100">View</a>
                    </div>
                </div>
            </div>
        }
    </div>
}

@section Scripts {
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
<script>
$(document).ready(function(){
    function filterDashboard() {
        var search = $('#searchInput').val().toLowerCase();
        var filterType = $('#filterSelect').val();
        var sortBy = $('#sortSelect').val();

        var items = $('.dashboard-item');

        // Filter & search
        items.each(function(){
            var name = $(this).data('name');
            var type = $(this).data('type');
            var show = true;

            if(search && !name.includes(search)) show = false;
            if(filterType && type !== filterType) show = false;

            $(this).toggle(show);
        });

        // Sort by name or date
        items.sort(function(a,b){
            if(sortBy==='name') return $(a).data('name').localeCompare($(b).data('name'));
            else if(sortBy==='date') return $(b).data('date') - $(a).data('date');
        });
    
        // Append items only to their respective container
        items.each(function(){
            var type = $(this).data('type');
            if(type === 'category') $('#categoriesContainer').append(this);
            else if(type === 'product') $('#productsContainer').append(this);
        });
    }

    $('#searchInput, #filterSelect, #sortSelect').on('input change', filterDashboard);
});
</script>
}

<style>
/* Dashboard card gradients */
.dashboard-card { color:#fff; border-radius:0.75rem; transition: transform 0.3s, box-shadow 0.3s; }
.dashboard-card.gradient-blue { background: linear-gradient(135deg, #1e3c72, #2a5298); }
.dashboard-card.gradient-purple { background: linear-gradient(135deg, #5c2a9d, #8b4dfa); }
.dashboard-card.gradient-orange { background: linear-gradient(135deg, #ff512f, #f09819); }
.dashboard-card:hover { transform: translateY(-5px) scale(1.02); box-shadow: 0 14px 28px rgba(0,0,0,0.25); }

/* Recent cards */
.recent-card { border:1px solid #e0e0e0; transition: transform 0.25s ease, box-shadow 0.25s ease; }
.recent-card:hover { transform: translateY(-6px) scale(1.03); box-shadow: 0 16px 32px rgba(0,0,0,0.2); }

.card-img-container { height: 150px; overflow:hidden; }
.card-img-top { width:100%; height:100%; object-fit:cover; }

/* Badge styling */
.badge { font-size:0.75rem; padding:0.3em 0.6em; border-radius:0.5rem; transition: transform 0.2s; }
.badge:hover { transform: scale(1.05); }

/* Typography tweaks */
h2,h4 { letter-spacing:0.5px; }

/* Filters styling */
#searchInput, #filterSelect, #sortSelect { border-radius:8px; padding:6px 12px; }
</style>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
